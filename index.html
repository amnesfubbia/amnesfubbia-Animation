<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Amnesfubbia – Animation Hub</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background:#060606; color:#fff; font-family: 'Inter', sans-serif; }
        .movie-card { background:#111; border-radius:8px; overflow:hidden; cursor:pointer; transition:.25s; border: 1px solid transparent; }
        .movie-card:hover { transform:scale(1.04); border:1px solid #3b82f6; }
        .badge { position:absolute; top:6px; left:6px; font-size:9px; font-weight:900; padding:2px 6px; border-radius:4px; z-index: 10; }
        .modal { display:none; position:fixed; inset:0; background:rgba(0,0,0,.95); z-index:100; overflow-y: auto; padding: 20px 10px; }
        .cast-img { width:54px; height:54px; border-radius:50%; object-fit:cover; border:2px solid #3b82f6; }
        .scrollbar-hide::-webkit-scrollbar { display:none; }
        /* Perbaikan untuk modal agar bisa di-scroll di HP */
        .modal-container { margin: auto; }
    </style>
</head>
<body>

<nav class="fixed top-0 w-full bg-black/95 p-3 z-50 border-b border-gray-900">
    <div class="flex gap-2 items-center max-w-6xl mx-auto">
        <span onclick="location.reload()" class="font-black italic text-blue-500 cursor-pointer tracking-tighter text-lg">AMNESFUBBIA</span>
        <form onsubmit="event.preventDefault(); searchMovies();" class="flex flex-1 gap-2">
            <input id="searchInput" placeholder="Cari animasi..." class="flex-1 bg-zinc-900 p-2 text-xs rounded outline-none focus:ring-1 focus:ring-blue-500">
            <button type="submit" class="bg-blue-600 hover:bg-blue-700 px-4 py-2 text-xs rounded font-bold transition">CARI</button>
        </form>
    </div>
</nav>

<main class="pt-24 px-4 pb-10 max-w-7xl mx-auto">
    <div id="movieGrid" class="grid grid-cols-3 sm:grid-cols-4 md:grid-cols-6 lg:grid-cols-7 gap-3"></div>
</main>

<div id="movieModal" class="modal" onclick="if(event.target === this) closeModal()">
    <div class="modal-container bg-[#0f0f0f] max-w-4xl w-full rounded-xl overflow-hidden relative shadow-2xl border border-zinc-800">
        <button onclick="closeModal()" class="absolute top-3 right-3 bg-blue-600 hover:bg-red-600 w-8 h-8 rounded-full z-20 transition">✕</button>
        <div id="modalContent" class="flex flex-col md:flex-row"></div>
    </div>
</div>

<script>
const API = 'https://api.themoviedb.org/3';
const KEY = 'bfa7df5310c9974f62f26c6789a8c00d';
const IMG = 'https://image.tmdb.org/t/p/w500';

async function loadMovies(){
    movieGrid.innerHTML = '<div class="col-span-full text-center py-20 animate-pulse text-blue-500 font-bold">LOADING ANIMATION...</div>';
    try {
        const res = await fetch(`${API}/discover/movie?api_key=${KEY}&with_genres=16&sort_by=popularity.desc`);
        const data = await res.json();
        renderMovies(data.results);
    } catch (e) {
        movieGrid.innerHTML = '<p class="col-span-full text-center">Gagal memuat data.</p>';
    }
}

async function searchMovies(){
    const q = document.getElementById('searchInput').value.trim();
    if(!q) return loadMovies();

    movieGrid.innerHTML = '<p class="col-span-full text-center py-20">Mencari...</p>';
    
    try {
        const res = await fetch(`${API}/search/movie?api_key=${KEY}&query=${encodeURIComponent(q)}`);
        const data = await res.json();
        // Memastikan hanya menampilkan animasi (Genre 16)
        const filtered = data.results.filter(m => m.genre_ids && m.genre_ids.includes(16));
        renderMovies(filtered);
    } catch (e) {
        movieGrid.innerHTML = '<p class="col-span-full text-center">Terjadi kesalahan saat mencari.</p>';
    }
}

function getBadge(m){
    if(m.first_air_date) return 'TV';
    if(m.release_date && m.release_date < '1990-01-01') return 'OLD';
    return 'MOVIE';
}

function renderMovies(list){
    const grid = document.getElementById('movieGrid');
    grid.innerHTML = '';
    
    if(!list || list.length === 0){
        grid.innerHTML = '<p class="col-span-full text-center text-gray-500 py-20">Animasi tidak ditemukan.</p>';
        return;
    }

    list.forEach(m => {
        if(!m.poster_path) return;
        const div = document.createElement('div');
        div.className = 'movie-card';
        div.onclick = () => showDetail(m.id);
        div.innerHTML = `
            <div class="relative">
                <img loading="lazy" src="${IMG + m.poster_path}" class="w-full aspect-[2/3] object-cover" alt="${m.title}">
                <span class="badge bg-blue-600 text-white shadow-lg">${getBadge(m)}</span>
            </div>
            <p class="text-[10px] p-2 truncate font-bold text-gray-200">${m.title}</p>
        `;
        grid.appendChild(div);
    });
}

async function showDetail(id){
    const content = document.getElementById('modalContent');
    const modal = document.getElementById('movieModal');
    content.innerHTML = '<div class="p-20 w-full text-center">Loading Detail...</div>';
    modal.style.display = 'flex';
    document.body.style.overflow = 'hidden';

    try {
        const res = await fetch(`${API}/movie/${id}?api_key=${KEY}&append_to_response=videos,credits`);
        const m = await res.json();

        const isShort = m.runtime && m.runtime <= 45;
        const trailer = m.videos.results.find(v => v.type === 'Trailer' && v.site === 'YouTube');

        content.innerHTML = `
            <img src="${IMG + m.poster_path}" class="w-full md:w-1/3 object-cover shadow-xl">
            <div class="p-6 md:w-2/3">
                <h2 class="text-2xl font-black text-blue-500 italic leading-tight mb-1">${m.title}</h2>
                <p class="text-[11px] text-gray-400 mb-4 tracking-widest uppercase font-bold">
                    ${m.release_date ? m.release_date.split('-')[0] : 'N/A'} • ${m.runtime || '?'} MENIT
                </p>
                <p class="text-[12px] leading-relaxed text-gray-300 mb-6 line-clamp-4 md:line-clamp-none">
                    ${m.overview || 'Sinopsis tidak tersedia untuk judul ini.'}
                </p>

                ${trailer ? `
                <div class="mb-6 rounded-lg overflow-hidden border border-zinc-800 shadow-lg">
                    <iframe class="w-full aspect-video" 
                    src="https://www.youtube.com/embed/${trailer.key}" 
                    allowfullscreen></iframe>
                </div>` : ''}

                <h3 class="text-[10px] font-black text-blue-500 mb-2 tracking-tighter">PENGISI SUARA / CAST</h3>
                <div class="flex gap-4 overflow-x-auto scrollbar-hide mb-6 pb-2">
                    ${m.credits.cast.slice(0, 10).map(c => `
                    <div onclick="loadCast(${c.id})" class="text-center cursor-pointer flex-shrink-0 group">
                        <img src="${c.profile_path ? IMG + c.profile_path : 'https://via.placeholder.com/150'}" 
                             class="cast-img mx-auto mb-1 group-hover:border-white transition">
                        <p class="text-[9px] w-16 truncate font-medium text-gray-400">${c.name}</p>
                    </div>`).join('')}
                </div>

                ${!isShort ? `
                <a href="https://vidsrc.to/embed/movie/${m.id}" target="_blank" 
                   class="block bg-blue-600 hover:bg-blue-500 py-3 text-center rounded-lg font-black text-xs transition tracking-widest shadow-lg">
                   MULAI STREAMING</a>` : `
                <p class="text-green-500 text-[10px] font-black italic bg-green-500/10 p-2 rounded border border-green-500/20">
                   ▶ SHORT FILM - Gunakan pemutar video di atas
                </p>`}
            </div>`;
    } catch (e) {
        content.innerHTML = '<p class="p-10 text-center">Gagal memuat detail film.</p>';
    }
}

async function loadCast(id){
    closeModal();
    const grid = document.getElementById('movieGrid');
    grid.innerHTML = '<p class="col-span-full text-center py-20 animate-pulse">Memuat film berdasarkan pemeran...</p>';
    try {
        const res = await fetch(`${API}/person/${id}/movie_credits?api_key=${KEY}`);
        const data = await res.json();
        // Filter animasi saja
        const animatedMovies = data.cast.filter(m => m.genre_ids && m.genre_ids.includes(16));
        renderMovies(animatedMovies);
    } catch (e) {
        grid.innerHTML = '<p class="col-span-full text-center">Gagal memuat data pemeran.</p>';
    }
}

function closeModal(){
    document.getElementById('movieModal').style.display = 'none';
    document.body.style.overflow = 'auto';
}

// Inisialisasi awal
loadMovies();
</script>

</body>
</html>
