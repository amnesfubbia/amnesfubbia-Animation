<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>amnesfubbia</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&display=swap" rel="stylesheet">
    <style>
        body { background-color: #000; color: #fff; font-family: 'Inter', sans-serif; margin: 0; overflow-x: hidden; -webkit-tap-highlight-color: transparent; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        
        /* SPLASH & SIDE MENU */
        #splashScreen { position: fixed; inset: 0; background: #000; z-index: 10000; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        #sideMenu { position: fixed; inset: 0; background: rgba(0,0,0,0.98); z-index: 9999; display: none; padding: 40px 25px; overflow-y: auto; }

        /* PROFILE UI */
        .profile-pic-container { position: relative; width: 80px; height: 80px; padding: 3px; background: linear-gradient(45deg, #f09433, #bc1888); border-radius: 50%; }
        .profile-pic-logo { width: 100%; height: 100%; border-radius: 50%; background: #000; padding: 10px; overflow: hidden; }
        .profile-pic-logo img { width: 100%; height: 100%; object-fit: contain; }

        /* BUTTONS */
        .btn-ig { flex: 1; background: #262626; border-radius: 8px; padding: 8px; font-size: 13px; font-weight: 600; text-align: center; cursor: pointer; }
        .btn-ig.active { background: #fff; color: #000; }
        .pill { background: transparent; border: 1px solid #333; color: #fff; padding: 8px; border-radius: 8px; font-size: 11px; font-weight: 700; text-align: center; }
        .active-pill { border-color: #fff; background: rgba(255,255,255,0.1); }

        /* DROPDOWNS */
        .filter-dropdown { position: fixed; bottom: 0; left: 0; right: 0; background: #121212; border-radius: 20px 20px 0 0; z-index: 9500; max-height: 60vh; overflow-y: auto; display: none; border-top: 1px solid #333; padding-bottom: 30px; }
        .filter-item { padding: 16px; font-size: 14px; text-align: center; border-bottom: 1px solid #262626; }

        /* GRID & CARDS */
        .movie-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 1px; padding-bottom: 100px; }
        .post-card { position: relative; aspect-ratio: 2/3; background: #111; overflow: hidden; }
        .post-card img { width: 100%; height: 100%; object-fit: cover; }
        .badge-rating { position: absolute; top: 6px; left: 6px; padding: 2px 5px; border-radius: 3px; font-size: 8px; font-weight: 900; background: rgba(255,255,255,0.9); color: #000; }

        /* SMART SEARCH DROPDOWN */
        #smartSearchDropdown { position: absolute; top: 100%; left: 0; right: 0; background: #1a1a1a; border-radius: 0 0 10px 10px; display: none; z-index: 500; max-height: 300px; overflow-y: auto; border: 1px solid #333; }
        .smart-item { display: flex; align-items: center; padding: 10px; gap: 12px; border-bottom: 1px solid #262626; }
        .smart-item img { width: 35px; height: 50px; object-fit: cover; border-radius: 4px; }

        /* MODAL */
        .modal-player { display: none; position: fixed; inset: 0; z-index: 9000; background: #000; overflow-y: auto; }
        .server-btn { background: #1a1a1a; border: 1px solid #333; padding: 10px; border-radius: 8px; font-size: 11px; font-weight: 700; color: #fff; }
        .server-btn.active { border-color: #fff; background: #333; }

        /* NAVIGATION */
        .bottom-nav { position: fixed; bottom: 0; width: 100%; background: #000; border-top: 1px solid #1c1c1c; display: flex; justify-content: space-around; padding: 15px 0; z-index: 1000; }
        .bottom-nav i { color: #8e8e8e; font-size: 20px; }
        .bottom-nav i.active-nav { color: #fff; }
    </style>
</head>
<body>

    <div id="splashScreen">
        <img src="amnesfubbia.png" style="width: 80px; margin-bottom: 15px;">
        <div class="font-black text-xl">amnesfubbia</div>
        <div class="absolute bottom-10 text-xs text-zinc-500 tracking-widest">FROM ANASTEAS</div>
    </div>

    <div id="sideMenu">
        <i class="fa-solid fa-xmark text-2xl absolute top-5 right-5" onclick="toggleSideMenu()"></i>
        <h2 class="text-2xl font-black mb-5">About</h2>
        <p class="text-zinc-400 text-sm leading-relaxed mb-5">Platform katalog sinema digital buatan Anasteas untuk eksplorasi film & series tanpa batas.</p>
        <div class="bg-zinc-900 p-4 rounded-xl border border-zinc-800">
            <ul class="space-y-4 text-xs">
                <li>✅ 25.000+ Database</li>
                <li>✅ Smart Search System</li>
                <li>✅ Local Bookmark Archive</li>
            </ul>
        </div>
    </div>

    <div id="mainProfile" style="display:none;">
        <header class="p-4 sticky top-0 bg-black z-50">
            <div class="flex justify-between items-center mb-4">
                <div class="text-xl font-black tracking-tighter" onclick="location.reload()">amnesfubbia <i class="fa-solid fa-chevron-down text-[10px]"></i></div>
                <div class="flex gap-5">
                    <i class="fa-regular fa-square-plus text-2xl" onclick="openSearch()"></i>
                    <i class="fa-solid fa-bars text-2xl" onclick="toggleSideMenu()"></i>
                </div>
            </div>

            <div class="flex items-center gap-6 mb-4">
                <div class="profile-pic-container">
                    <div class="profile-pic-logo"><img src="amnesfubbia.png"></div>
                </div>
                <div class="flex flex-grow justify-around text-center">
                    <div onclick="setFilter('movie', this)">
                        <span class="block font-bold">18k</span><span class="text-[10px] text-zinc-500 uppercase">Film</span>
                    </div>
                    <div onclick="setFilter('tv', this)">
                        <span class="block font-bold">7k</span><span class="text-[10px] text-zinc-500 uppercase">Series</span>
                    </div>
                    <div onclick="showLibrary('bookmarks')">
                        <span id="bookCount" class="block font-bold">0</span><span class="text-[10px] text-zinc-500 uppercase">Saved</span>
                    </div>
                </div>
            </div>

            <div class="text-sm mb-4">
                <div class="font-bold">amnesfubbia <i class="fa-solid fa-circle-check text-blue-500"></i></div>
                <div class="text-zinc-300">Discover & Archive Cinema.</div>
            </div>

            <div class="flex gap-2">
                <button id="btnTrending" class="btn-ig active" onclick="setSchedule('trending', this)">Populer</button>
                <button class="btn-ig" onclick="toggleFilter('genreDropdown')">Genre <i class="fa-solid fa-caret-down ml-1"></i></button>
            </div>
        </header>

        <main id="feedGrid" class="movie-grid"></main>
    </div>

    <div id="searchOverlay" class="fixed inset-0 bg-black z-[9999]" style="display:none;">
        <div class="p-4 flex items-center gap-3 border-b border-zinc-900 sticky top-0 bg-black">
            <i class="fa-solid fa-arrow-left text-xl" onclick="closeSearch()"></i>
            <div class="relative flex-grow">
                <input type="text" id="searchInp" placeholder="Cari film, series, aktor..." class="w-full bg-zinc-900 p-2 px-4 rounded-full text-sm outline-none">
                <div id="smartSearchDropdown" class="no-scrollbar"></div>
            </div>
        </div>
        <div id="searchGrid" class="movie-grid"></div>
    </div>

    <div id="movieModal" class="modal-player">
        <div class="p-4 flex items-center gap-4 border-b border-zinc-900 sticky top-0 bg-black z-50">
            <i class="fa-solid fa-xmark text-xl" onclick="closeModal()"></i>
            <div id="mTitle" class="font-bold truncate text-sm">Loading...</div>
        </div>
        <div id="playerArea" class="aspect-video bg-zinc-900"></div>
        <div class="p-4">
            <div class="flex justify-between items-center mb-4">
                <div class="flex gap-5 text-2xl">
                    <i class="fa-regular fa-heart" id="mLike" onclick="toggleLib('likes')"></i>
                    <i class="fa-regular fa-comment"></i>
                </div>
                <i class="fa-regular fa-bookmark text-2xl" id="mBook" onclick="toggleLib('bookmarks')"></i>
            </div>
            <div id="mMeta" class="text-xs font-bold text-blue-400 mb-2"></div>
            <div id="mDesc" class="text-sm text-zinc-400 leading-relaxed mb-6"></div>
            
            <h4 class="text-[10px] font-black uppercase text-zinc-500 mb-3 tracking-widest">Pilih Server</h4>
            <div id="serverList" class="grid grid-cols-2 gap-2"></div>
        </div>
    </div>

    <div id="filterOverlay" class="fixed inset-0 bg-black/70 z-[9400]" style="display:none;" onclick="closeD()"></div>
    <div id="genreDropdown" class="filter-dropdown no-scrollbar"></div>

    <nav class="bottom-nav">
        <i class="fa-solid fa-house active-nav" onclick="location.reload()"></i>
        <i class="fa-solid fa-magnifying-glass" onclick="openSearch()"></i>
        <i class="fa-regular fa-bookmark" onclick="showLibrary('bookmarks')"></i>
        <i class="fa-regular fa-heart" onclick="showLibrary('likes')"></i>
    </nav>

    <script>
        const API_KEY = 'bfa7df5310c9974f62f26c6789a8c00d';
        let page = 1, currentType = 'multi', currentGenre = '', currentMode = 'trending', loading = false;
        let activeId, activeType;

        window.onload = () => {
            setTimeout(() => { document.getElementById('splashScreen').style.display = 'none'; document.getElementById('mainProfile').style.display = 'block'; }, 2500);
            loadFeed();
            initGenreList();
            initSmartSearch();
            updateBookCount();
        };

        async function loadFeed(isNew = true) {
            if(loading) return;
            loading = true;
            const grid = document.getElementById('feedGrid');
            if(isNew) { page = 1; grid.innerHTML = ''; }

            let url = `https://api.themoviedb.org/3/trending/all/day?api_key=${API_KEY}&page=${page}&language=id-ID`;
            if(currentMode === 'discover') {
                url = `https://api.themoviedb.org/3/discover/${currentType}?api_key=${API_KEY}&page=${page}&with_genres=${currentGenre}&language=id-ID&sort_by=popularity.desc`;
            }

            try {
                const res = await fetch(url);
                const data = await res.json();
                renderGrid(data.results, grid);
            } catch(e) { console.error(e); }
            loading = false;
        }

        function renderGrid(items, grid) {
            items.forEach(m => {
                if(!m.poster_path) return;
                const card = document.createElement('div');
                card.className = 'post-card';
                card.onclick = () => openModal(m.id, m.media_type || currentType);
                card.innerHTML = `
                    <div class="badge-rating">★ ${(m.vote_average||0).toFixed(1)}</div>
                    <img src="https://image.tmdb.org/t/p/w342${m.poster_path}" loading="lazy">
                `;
                grid.appendChild(card);
            });
        }

        // SMART SEARCH LOGIC
        function initSmartSearch() {
            const inp = document.getElementById('searchInp'), drop = document.getElementById('smartSearchDropdown');
            inp.addEventListener('input', async () => {
                const q = inp.value.trim();
                if(q.length < 3) { drop.style.display = 'none'; return; }
                const res = await fetch(`https://api.themoviedb.org/3/search/multi?api_key=${API_KEY}&query=${q}&language=id-ID`);
                const data = await res.json();
                const results = data.results.slice(0, 5);
                drop.innerHTML = results.map(m => `
                    <div class="smart-item" onclick="openModal(${m.id}, '${m.media_type}')">
                        <img src="https://image.tmdb.org/t/p/w92${m.poster_path || m.profile_path}">
                        <div>
                            <div class="text-xs font-bold">${m.title || m.name}</div>
                            <div class="text-[10px] text-zinc-500 uppercase">${m.media_type}</div>
                        </div>
                    </div>
                `).join('');
                drop.style.display = 'block';
            });
        }

        // MODAL & PLAYER
        async function openModal(id, type) {
            activeId = id; activeType = type;
            const modal = document.getElementById('movieModal');
            modal.style.display = 'block';
            document.body.style.overflow = 'hidden';

            const res = await fetch(`https://api.themoviedb.org/3/${type}/${id}?api_key=${API_KEY}&language=id-ID`);
            const data = await res.json();

            document.getElementById('mTitle').innerText = data.title || data.name;
            document.getElementById('mDesc').innerText = data.overview || "Sinopsis tidak tersedia.";
            document.getElementById('mMeta').innerText = `${(data.genres || []).map(g => g.name).join(' • ')}`;
            
            const servers = [
                {n: 'SERVER 1 (VIP)', u: `https://vidsrc.me/embed/${type}?tmdb=${id}`},
                {n: 'SERVER 2 (HQ)', u: `https://vidlink.pro/${type}/${id}`},
                {n: 'SERVER 3 (MULTI)', u: `https://vidsrc.cc/v2/embed/${type}/${id}`}
            ];
            
            document.getElementById('serverList').innerHTML = servers.map((s, i) => `
                <button class="server-btn ${i===0?'active':''}" onclick="play(this, '${s.u}')">${s.n}</button>
            `).join('');
            
            play(null, servers[0].u);
            updateModalButtons();
        }

        function play(btn, url) {
            if(btn) {
                document.querySelectorAll('.server-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
            }
            document.getElementById('playerArea').innerHTML = `<iframe src="${url}" class="w-full h-full" allowfullscreen></iframe>`;
        }

        // BOOKMARK & LIBRARY
        function toggleLib(key) {
            let list = JSON.parse(localStorage.getItem(key) || '[]');
            const idx = list.findIndex(x => x.id == activeId);
            if(idx > -1) list.splice(idx, 1);
            else list.push({id: activeId, type: activeType});
            localStorage.setItem(key, JSON.stringify(list));
            updateModalButtons();
            updateBookCount();
        }

        function updateModalButtons() {
            const isLiked = JSON.parse(localStorage.getItem('likes') || '[]').some(x => x.id == activeId);
            const isBooked = JSON.parse(localStorage.getItem('bookmarks') || '[]').some(x => x.id == activeId);
            document.getElementById('mLike').className = isLiked ? 'fa-solid fa-heart text-red-500' : 'fa-regular fa-heart';
            document.getElementById('mBook').className = isBooked ? 'fa-solid fa-bookmark text-white' : 'fa-regular fa-bookmark';
        }

        async function showLibrary(key) {
            const list = JSON.parse(localStorage.getItem(key) || '[]');
            const grid = document.getElementById('feedGrid');
            grid.innerHTML = '';
            closeSearch();
            
            if(list.length === 0) {
                grid.innerHTML = `<div class="col-span-3 text-center py-20 text-zinc-600 text-sm">Belum ada koleksi di sini.</div>`;
                return;
            }

            for(const item of list) {
                const res = await fetch(`https://api.themoviedb.org/3/${item.type}/${item.id}?api_key=${API_KEY}&language=id-ID`);
                const data = await res.json();
                renderGrid([data], grid);
            }
        }

        function updateBookCount() {
            const list = JSON.parse(localStorage.getItem('bookmarks') || '[]');
            document.getElementById('bookCount').innerText = list.length;
        }

        // UTILS
        function toggleSideMenu() { 
            const s = document.getElementById('sideMenu');
            s.style.display = s.style.display === 'block' ? 'none' : 'block';
        }

        function toggleFilter(id) { 
            document.getElementById(id).style.display = 'block'; 
            document.getElementById('filterOverlay').style.display = 'block'; 
        }

        function closeD() { 
            document.querySelectorAll('.filter-dropdown').forEach(d => d.style.display = 'none'); 
            document.getElementById('filterOverlay').style.display = 'none'; 
        }

        function initGenreList() {
            const genres = [[28,'Action'],[12,'Adventure'],[16,'Animasi'],[35,'Komedi'],[27,'Horror'],[10749,'Romance'],[878,'Sci-Fi'],[18,'Drama']];
            const drop = document.getElementById('genreDropdown');
            drop.innerHTML = `<div class="p-4 text-xs font-black text-zinc-500 uppercase tracking-widest border-b border-zinc-900">Pilih Genre</div>` + 
                genres.map(g => `<div class="filter-item" onclick="currentGenre='${g[0]}'; currentMode='discover'; closeD(); loadFeed(true);">${g[1]}</div>`).join('');
        }

        function setFilter(type, el) {
            currentType = type; currentMode = 'discover';
            loadFeed(true);
        }

        function setSchedule(mode, el) {
            currentMode = mode;
            document.getElementById('btnTrending').classList.add('active');
            loadFeed(true);
        }

        function openSearch() { document.getElementById('searchOverlay').style.display = 'block'; document.getElementById('searchInp').focus(); }
        function closeSearch() { document.getElementById('searchOverlay').style.display = 'none'; }
        function closeModal() { document.getElementById('movieModal').style.display = 'none'; document.getElementById('playerArea').innerHTML = ''; document.body.style.overflow='auto'; }

        window.onscroll = () => { if((window.innerHeight + window.scrollY) >= document.body.offsetHeight - 800) { page++; loadFeed(false); } };
    </script>
</body>
</html>
